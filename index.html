<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Mentor - H∆∞·ªõng nghi·ªáp ƒêi·ªÅu D∆∞·ª°ng</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

</head>
<body class="bg-slate-50 min-h-screen p-3 sm:p-6 font-sans text-slate-800">

    <div class="max-w-5xl mx-auto bg-white shadow-2xl rounded-3xl overflow-hidden border border-slate-100">

        <!-- Hero Header with Gradient -->
        <header class="bg-gradient-to-r from-teal-700 to-emerald-600 p-8 text-white relative overflow-hidden">
            <!-- Decorative Circles -->
            <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 rounded-full bg-white opacity-10"></div>
            <div class="absolute bottom-0 left-0 -ml-10 -mb-10 w-40 h-40 rounded-full bg-white opacity-10"></div>

            <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="bg-white/20 p-2 rounded-lg backdrop-blur-sm">
                            <i data-lucide="stethoscope" class="w-8 h-8 text-white"></i>
                        </div>
                        <h1 class="header-font text-2xl md:text-3xl font-bold tracking-tight">H∆∞·ªõng nghi·ªáp & T∆∞ v·∫•n ch·ªçn ngh·ªÅ</h1>
                    </div>
                    <!-- <div class="flex items-center gap-2">
                        <button onclick="resetApiKey()" class="text-xs font-medium bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full backdrop-blur-sm transition" title="X√≥a Key ƒë√£ l∆∞u ƒë·ªÉ nh·∫≠p l·∫°i">
                            üîë ƒê·ªïi Key
                        </button>
                        <div class="text-sm font-medium bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm">
                            Phi√™n b·∫£n 2.4 (Auto Key)
                        </div>
                    </div> -->
                </div>
                
                <p id="step-name" class="text-lg md:text-xl text-emerald-50 font-medium mb-6">Kh·ªüi t·∫°o h·ªì s∆° chuy√™n m√¥n</p>
                
                <div class="flex items-center space-x-4">
                    <div class="flex-grow">
                        <div class="progress-container bg-emerald-800/30">
                            <div id="progress-bar" class="progress-bar bg-white"></div>
                        </div>
                    </div>
                    <span id="step-counter" class="text-sm font-bold whitespace-nowrap">1 / 3</span>
                </div>
            </div>
        </header>

        <main class="p-6 md:p-10">
            <!-- Step 1: Nh·∫≠p D·ªØ li·ªáu & Ch·ªçn Chuy√™n Ng√†nh -->
            <div id="step-1" class="step-page active">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mr-4">
                        <span class="font-bold text-lg">1</span>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800">Th√¥ng tin & ƒê·ªãnh h∆∞·ªõng</h2>
                </div>

                <!-- Ch·ªçn Chuy√™n Ng√†nh (Visual Updated) -->
                <div class="mb-8 bg-gradient-to-br from-slate-50 to-blue-50 p-6 rounded-2xl border border-blue-100 shadow-sm">
                    <label for="career-path-select" class="block text-lg font-semibold text-slate-800 mb-3 flex items-center">
                        <i data-lucide="compass" class="w-5 h-5 mr-2 text-blue-600"></i>
                        Ch·ªçn Chuy√™n Ng√†nh M·ª•c ti√™u
                    </label>
                    <div class="relative">
                        <select id="career-path-select" class="w-full p-4 pl-5 border border-blue-200 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white appearance-none cursor-pointer text-slate-700 font-medium text-base">
                            <option value="">-- Ch·ªçn lƒ©nh v·ª±c b·∫°n mu·ªën ph√°t tri·ªÉn --</option>
                            <optgroup label="üè• L√¢m s√†ng (Clinical)">
                                <option value="ƒêi·ªÅu d∆∞·ª°ng L√¢m s√†ng - N·ªôi/Ngo·∫°i khoa">N·ªôi/Ngo·∫°i khoa</option>
                                <option value="ƒêi·ªÅu d∆∞·ª°ng L√¢m s√†ng - H·ªìi s·ª©c (ICU/CCU)">ICU - H·ªìi s·ª©c C·∫•p c·ª©u</option>
                                <option value="ƒêi·ªÅu d∆∞·ª°ng L√¢m s√†ng - Ph√≤ng m·ªï/G√¢y m√™">Ph√≤ng m·ªï - G√¢y m√™</option>
                            </optgroup>
                            <optgroup label="üë∂ Chuy√™n khoa ƒê·∫∑c bi·ªát">
                                <option value="ƒêi·ªÅu d∆∞·ª°ng Chuy√™n khoa Ph·∫´u thu·∫≠t - Nhi">Nhi khoa</option>
                                <option value="ƒêi·ªÅu d∆∞·ª°ng Chuy√™n khoa Ph·∫´u thu·∫≠t - T√¢m th·∫ßn">S·ª©c kh·ªèe T√¢m th·∫ßn</option>
                                <option value="ƒêi·ªÅu d∆∞·ª°ng Chuy√™n khoa Ph·∫´u thu·∫≠t - S·∫£n">S·∫£n ph·ª• khoa</option>
                            </optgroup>
                            <optgroup label="üåø Y t·∫ø C·ªông ƒë·ªìng">
                                <option value="ƒêi·ªÅu d∆∞·ª°ng Y t·∫ø C·ªông ƒë·ªìng - Tr·∫°m Y t·∫ø/Ti√™m ch·ªßng">Tr·∫°m Y t·∫ø / Ti√™m ch·ªßng</option>
                                <option value="ƒêi·ªÅu d∆∞·ª°ng Y t·∫ø C·ªông ƒë·ªìng - T∆∞ v·∫•n/GDSK">T∆∞ v·∫•n & Gi√°o d·ª•c S·ª©c kh·ªèe</option>
                            </optgroup>
                            <optgroup label="üè† ChƒÉm s√≥c t·∫°i nh√†">
                                <option value="ƒêi·ªÅu d∆∞·ª°ng CS t·∫°i nh√† - ChƒÉm s√≥c ng∆∞·ªùi cao tu·ªïi">ChƒÉm s√≥c ng∆∞·ªùi cao tu·ªïi (Home Care)</option>
                                <option value="ƒêi·ªÅu d∆∞·ª°ng CS t·∫°i nh√† - Ph·ª•c h·ªìi sau m·ªï">Ph·ª•c h·ªìi ch·ª©c nƒÉng</option>
                            </optgroup>
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-blue-500">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </div>
                    </div>
                </div>

                <!-- Tab Buttons -->
                <div class="flex p-1 space-x-2 bg-slate-100 rounded-xl w-full md:w-fit mb-6">
                    <button class="tab-button flex-1 md:w-48 active" onclick="showTab('manual-input', this)">
                        <i data-lucide="user-pen" class="w-4 h-4 mr-2"></i> Nh·∫≠p Form
                    </button>
                    <button class="tab-button flex-1 md:w-48" onclick="showTab('cv-input-area', this)">
                        <i data-lucide="file-input" class="w-4 h-4 mr-2"></i> D√°n CV c√≥ s·∫µn
                    </button>
                </div>

                <!-- Tab Content: Manual Input -->
                <div id="manual-input" class="tab-content space-y-6 active">
                    <!-- Th√¥ng tin c∆° b·∫£n -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="group">
                            <label class="block text-sm font-medium text-slate-600 mb-1 flex items-center"><i data-lucide="user" class="w-4 h-4 mr-1"></i> H·ªç v√† T√™n</label>
                            <input type="text" id="name-input" placeholder="Nguy·ªÖn VƒÉn A" class="form-input w-full p-3 border border-slate-300 rounded-lg">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1 flex items-center"><i data-lucide="calendar" class="w-4 h-4 mr-1"></i> Tu·ªïi</label>
                                <input type="number" id="age-input" placeholder="25" class="form-input w-full p-3 border border-slate-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1 flex items-center"><i data-lucide="users" class="w-4 h-4 mr-1"></i> Gi·ªõi t√≠nh</label>
                                <select id="gender-input" class="form-input w-full p-3 border border-slate-300 rounded-lg">
                                    <option value="Nam">Nam</option>
                                    <option value="N·ªØ">N·ªØ</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1 flex items-center"><i data-lucide="graduation-cap" class="w-4 h-4 mr-1"></i> Tr√¨nh ƒë·ªô cao nh·∫•t</label>
                            <select id="degree-input" class="form-input w-full p-3 border border-slate-300 rounded-lg">
                                <option>Cao ƒë·∫≥ng</option>
                                <option>C·ª≠ nh√¢n</option>
                                <option>Th·∫°c sƒ©</option>
                                <option>Chuy√™n khoa I/II</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1 flex items-center"><i data-lucide="briefcase" class="w-4 h-4 mr-1"></i> Kinh nghi·ªám (NƒÉm)</label>
                            <input type="number" id="experience-input" value="0" min="0" class="form-input w-full p-3 border border-slate-300 rounded-lg">
                        </div>
                    </div>

                    <!-- Ch·ª©ng ch·ªâ -->
                    <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
                        <label class="block text-base font-semibold text-slate-700 mb-3 flex items-center">
                            <i data-lucide="award" class="w-5 h-5 mr-2 text-emerald-600"></i> Ch·ª©ng ch·ªâ & B·∫±ng c·∫•p kh√°c
                        </label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 max-h-48 overflow-y-auto pr-2 custom-scrollbar">
                            <label class="flex items-center p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" name="certificate" value="CCHN KCB (ƒêi·ªÅu d∆∞·ª°ng)" class="mr-3 rounded text-emerald-600 focus:ring-emerald-500 w-5 h-5"> CCHN KCB (ƒêi·ªÅu d∆∞·ª°ng)</label>
                            <label class="flex items-center p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" name="certificate" value="Ngo·∫°i ng·ªØ (Anh/Nh·∫≠t/ƒê·ª©c)" class="mr-3 rounded text-emerald-600 focus:ring-emerald-500 w-5 h-5"> Ngo·∫°i ng·ªØ (IELTS/TOEIC...)</label>
                            <label class="flex items-center p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" name="certificate" value="Tin h·ªçc vƒÉn ph√≤ng" class="mr-3 rounded text-emerald-600 focus:ring-emerald-500 w-5 h-5"> Tin h·ªçc vƒÉn ph√≤ng</label>
                            <label class="flex items-center p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" name="certificate" value="Ki·ªÉm so√°t nhi·ªÖm khu·∫©n" class="mr-3 rounded text-emerald-600 focus:ring-emerald-500 w-5 h-5"> Ki·ªÉm so√°t nhi·ªÖm khu·∫©n</label>
                            <label class="flex items-center p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" name="certificate" value="An to√†n ti√™m ch·ªßng" class="mr-3 rounded text-emerald-600 focus:ring-emerald-500 w-5 h-5"> An to√†n ti√™m ch·ªßng</label>
                            <label class="flex items-center p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" name="certificate" value="H·ªìi s·ª©c c·∫•p c·ª©u (ICU)" class="mr-3 rounded text-emerald-600 focus:ring-emerald-500 w-5 h-5"> H·ªìi s·ª©c c·∫•p c·ª©u (ICU)</label>
                            <label class="flex items-center p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" name="certificate" value="S∆∞ ph·∫°m Y h·ªçc" class="mr-3 rounded text-emerald-600 focus:ring-emerald-500 w-5 h-5"> S∆∞ ph·∫°m Y h·ªçc</label>
                            <label class="flex items-center p-2 hover:bg-slate-50 rounded cursor-pointer"><input type="checkbox" name="certificate" value="ChƒÉm s√≥c v·∫øt th∆∞∆°ng" class="mr-3 rounded text-emerald-600 focus:ring-emerald-500 w-5 h-5"> ChƒÉm s√≥c v·∫øt th∆∞∆°ng</label>
                        </div>
                        <div class="mt-3 pt-3 border-t border-slate-100">
                            <input type="text" id="cert-other-input" placeholder="+ Nh·∫≠p ch·ª©ng ch·ªâ kh√°c (c√°ch nhau d·∫•u ph·∫©y)" class="w-full p-2 text-sm border border-slate-300 rounded-lg bg-slate-50 focus:bg-white transition">
                        </div>
                    </div>

                    <!-- T√≥m t·∫Øt b·∫£n th√¢n -->
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1 flex items-center"><i data-lucide="fingerprint" class="w-4 h-4 mr-1"></i> Phong c√°ch l√†m vi·ªác</label>
                        <select id="summary-select" class="form-input w-full p-3 border border-slate-300 rounded-lg mb-2" onchange="toggleCustomSummary()">
                            <option value="dynamic">üèÉ Ng∆∞·ªùi NƒÉng ƒë·ªông (Th√≠ch giao ti·∫øp, Qu·∫£n l√Ω, C·ªông ƒë·ªìng)</option>
                            <option value="cautious">üî¨ Ng∆∞·ªùi C·∫©n tr·ªçng (Chi ti·∫øt, ICU, Ph√≤ng m·ªï, K·ªπ thu·∫≠t cao)</option>
                            <option value="stable">ü§ù Ng∆∞·ªùi ·ªîn ƒë·ªãnh (Ki√™n nh·∫´n, ChƒÉm s√≥c d√†i h·∫°n, Ph·ª•c h·ªìi)</option>
                            <option value="custom">‚úçÔ∏è T·ª± vi·∫øt m√¥ t·∫£ b·∫£n th√¢n...</option>
                        </select>
                        <textarea id="summary-input" rows="3" class="w-full p-3 border border-slate-300 rounded-lg hidden" placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ b·∫£n th√¢n v√† m·ª•c ti√™u ngh·ªÅ nghi·ªáp..."></textarea>
                        <p id="summary-placeholder" class="text-sm text-emerald-600 italic bg-emerald-50 p-2 rounded border border-emerald-100">
                            "T√¥i l√† ng∆∞·ªùi nƒÉng ƒë·ªông..." (Ch·ªçn danh m·ª•c tr√™n ƒë·ªÉ AI t·ª± ƒëi·ªÅn)
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- L∆∞∆°ng & M√¥i tr∆∞·ªùng -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1 flex items-center"><i data-lucide="banknote" class="w-4 h-4 mr-1"></i> M·ª©c l∆∞∆°ng mong mu·ªën</label>
                                <div class="flex">
                                    <select id="salary-preset" class="form-input flex-grow p-3 border border-slate-300 rounded-l-lg bg-white">
                                        <option value="8000000">8,000,000 VND</option>
                                        <option value="10000000">10,000,000 VND</option>
                                        <option value="12000000">12,000,000 VND</option>
                                        <option value="15000000">15,000,000 VND</option>
                                        <option value="20000000">20,000,000+ VND</option>
                                        <option value="other">S·ªë kh√°c...</option>
                                    </select>
                                    <input type="number" id="salary-custom-input" placeholder="Nh·∫≠p s·ªë..." class="w-24 p-3 border-t border-r border-slate-300 rounded-r-lg hidden">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1 flex items-center"><i data-lucide="building-2" class="w-4 h-4 mr-1"></i> M√¥i tr∆∞·ªùng ∆∞u ti√™n</label>
                                <select id="environment-input" class="form-input w-full p-3 border border-slate-300 rounded-lg">
                                    <option value="B·ªánh vi·ªán c√¥ng tuy·∫øn trung ∆∞∆°ng">BV C√¥ng tuy·∫øn TW</option>
                                    <option value="B·ªánh vi·ªán c√¥ng tuy·∫øn t·ªânh/huy·ªán">BV C√¥ng tuy·∫øn T·ªânh/Huy·ªán</option>
                                    <option value="B·ªánh vi·ªán Qu·ªëc t·∫ø/T∆∞ nh√¢n">BV Qu·ªëc t·∫ø / T∆∞ nh√¢n</option>
                                    <option value="Ph√≤ng kh√°m ƒëa khoa">Ph√≤ng kh√°m ƒêa khoa</option>
                                    <option value="Y t·∫ø d·ª± ph√≤ng/Tr·∫°m y t·∫ø">Y t·∫ø d·ª± ph√≤ng / Tr·∫°m y t·∫ø</option>
                                </select>
                            </div>
                        </div>

                        <!-- K·ªπ nƒÉng (ƒê√É C·∫¨P NH·∫¨T GIAO DI·ªÜN L·ªöN H∆†N) -->
                        <div class="col-span-1 md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Hard Skills -->
                            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                <label class="block text-sm font-bold text-blue-800 mb-2 flex items-center">
                                    <i data-lucide="activity" class="w-4 h-4 mr-2"></i> K·ªπ nƒÉng Chuy√™n m√¥n (Hard Skills)
                                </label>
                                <div class="space-y-2 h-48 overflow-y-auto pr-2 custom-scrollbar text-sm bg-white p-2 rounded border border-blue-200">
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="L·∫•y ven/Ti√™m truy·ªÅn kh√≥" class="mr-2 rounded"> L·∫•y ven/Ti√™m truy·ªÅn kh√≥</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="ƒê·ªçc ECG & Monitor" class="mr-2 rounded"> ƒê·ªçc ECG & Monitor</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="C·∫•p c·ª©u ng·ª´ng tu·∫ßn ho√†n (CPR/BLS)" class="mr-2 rounded"> C·∫•p c·ª©u ng·ª´ng tu·∫ßn ho√†n (CPR)</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="S·ª≠ d·ª•ng & Cai m√°y th·ªü" class="mr-2 rounded"> S·ª≠ d·ª•ng & Cai m√°y th·ªü</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="ChƒÉm s√≥c v·∫øt th∆∞∆°ng/Thay bƒÉng" class="mr-2 rounded"> ChƒÉm s√≥c v·∫øt th∆∞∆°ng/Thay bƒÉng</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="ƒê·∫∑t & ChƒÉm s√≥c Sonde (D·∫° d√†y/Ti·ªÉu)" class="mr-2 rounded"> ƒê·∫∑t & ChƒÉm s√≥c Sonde</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="Qu·∫£n l√Ω ƒë∆∞·ªùng truy·ªÅn trung t√¢m (CVC)" class="mr-2 rounded"> Qu·∫£n l√Ω ƒë∆∞·ªùng truy·ªÅn trung t√¢m</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="L·ªçc m√°u/Ch·∫°y th·∫≠n nh√¢n t·∫°o" class="mr-2 rounded"> L·ªçc m√°u/Ch·∫°y th·∫≠n nh√¢n t·∫°o</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="H·ªó tr·ª£ ph·∫´u thu·∫≠t (D·ª•ng c·ª•)" class="mr-2 rounded"> H·ªó tr·ª£ ph·∫´u thu·∫≠t (D·ª•ng c·ª•)</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="hard-skill" value="S·ª≠ d·ª•ng PM H·ªì s∆° b·ªánh √°n (EMR)" class="mr-2 rounded"> S·ª≠ d·ª•ng PM H·ªì s∆° b·ªánh √°n (EMR)</label>
                                </div>
                                <input type="text" id="hard-skill-custom" placeholder="+ K·ªπ nƒÉng chuy√™n m√¥n kh√°c..." class="mt-2 w-full p-2 text-xs border border-blue-200 rounded bg-white">
                            </div>

                            <!-- Soft Skills -->
                            <div class="bg-pink-50 p-4 rounded-xl border border-pink-100">
                                <label class="block text-sm font-bold text-pink-800 mb-2 flex items-center">
                                    <i data-lucide="smile" class="w-4 h-4 mr-2"></i> K·ªπ nƒÉng M·ªÅm (Soft Skills)
                                </label>
                                <div class="space-y-2 h-48 overflow-y-auto pr-2 custom-scrollbar text-sm bg-white p-2 rounded border border-pink-200">
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="soft-skill" value="Giao ti·∫øp tr·∫Øc ·∫©n (Empathy)" class="mr-2 rounded"> Giao ti·∫øp tr·∫Øc ·∫©n (Empathy)</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="soft-skill" value="Ch·ªãu √°p l·ª±c cao/Qu·∫£n l√Ω Stress" class="mr-2 rounded"> Ch·ªãu √°p l·ª±c cao/Qu·∫£n l√Ω Stress</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="soft-skill" value="L√†m vi·ªác nh√≥m ƒëa chuy√™n khoa" class="mr-2 rounded"> L√†m vi·ªác nh√≥m ƒëa chuy√™n khoa</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="soft-skill" value="T∆∞ duy ph·∫£n bi·ªán & Ra quy·∫øt ƒë·ªãnh" class="mr-2 rounded"> T∆∞ duy ph·∫£n bi·ªán & Ra quy·∫øt ƒë·ªãnh</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="soft-skill" value="Gi·∫£i quy·∫øt xung ƒë·ªôt/Khi·∫øu n·∫°i" class="mr-2 rounded"> Gi·∫£i quy·∫øt xung ƒë·ªôt/Khi·∫øu n·∫°i</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="soft-skill" value="Qu·∫£n l√Ω th·ªùi gian & S·∫Øp x·∫øp ca k√≠p" class="mr-2 rounded"> Qu·∫£n l√Ω th·ªùi gian & S·∫Øp x·∫øp ca k√≠p</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="soft-skill" value="Ti·∫øng Anh chuy√™n ng√†nh Y" class="mr-2 rounded"> Ti·∫øng Anh chuy√™n ng√†nh Y</label>
                                    <label class="flex items-center p-1 hover:bg-slate-50"><input type="checkbox" name="soft-skill" value="K·ªπ nƒÉng s∆∞ ph·∫°m/ƒê√†o t·∫°o" class="mr-2 rounded"> K·ªπ nƒÉng s∆∞ ph·∫°m/ƒê√†o t·∫°o</label>
                                </div>
                                <input type="text" id="soft-skill-custom" placeholder="+ K·ªπ nƒÉng m·ªÅm kh√°c..." class="mt-2 w-full p-2 text-xs border border-pink-200 rounded bg-white">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: CV Paste -->
                <div id="cv-input-area" class="tab-content">
                    <div class="bg-blue-50 border border-blue-100 rounded-xl p-4 mb-4">
                        <p class="text-sm text-blue-800 flex items-start">
                            <i data-lucide="info" class="w-5 h-5 mr-2 flex-shrink-0"></i>
                            AI s·∫Ω t·ª± ƒë·ªông tr√≠ch xu·∫•t kinh nghi·ªám v√† k·ªπ nƒÉng t·ª´ n·ªôi dung CV c·ªßa b·∫°n ƒë·ªÉ ƒë∆∞a ra t∆∞ v·∫•n ch√≠nh x√°c nh·∫•t.
                        </p>
                    </div>
                    <textarea id="cv-content-input" rows="12" placeholder="D√°n to√†n b·ªô n·ªôi dung CV (Copy & Paste) v√†o ƒë√¢y..." class="w-full p-4 border border-slate-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 font-mono text-sm"></textarea>
                </div>

                <button onclick="submitPersonalData()" class="mt-8 w-full py-4 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-emerald-500/30 hover:-translate-y-1 transition-all duration-300 flex items-center justify-center">
                    Ph√¢n T√≠ch H·ªì S∆° & T∆∞ V·∫•n Ngay <i data-lucide="arrow-right" class="w-6 h-6 ml-2"></i>
                </button>
            </div>

            <!-- Step 2: Ph√¢n T√≠ch & L·ªô Tr√¨nh -->
            <div id="step-2" class="step-page">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 mr-4">
                        <span class="font-bold text-lg">2</span>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800">AI Mentor Ph√¢n T√≠ch & ƒê·ªãnh H∆∞·ªõng</h2>
                </div>

                <div id="career-advice-container" class="bg-white rounded-2xl border border-slate-100 shadow-xl overflow-hidden min-h-[300px]">
                    <!-- Placeholder state -->
                    <div id="analysis-loading" class="flex flex-col items-center justify-center h-64 text-slate-500 hidden">
                        <div class="relative w-16 h-16 mb-4">
                            <div class="absolute top-0 left-0 w-full h-full border-4 border-slate-200 rounded-full"></div>
                            <div class="absolute top-0 left-0 w-full h-full border-4 border-emerald-500 rounded-full animate-spin border-t-transparent"></div>
                        </div>
                        <p class="animate-pulse font-medium">ƒêang ph√¢n t√≠ch d·ªØ li·ªáu h·ªì s∆°...</p>
                        <p class="text-xs mt-2 text-slate-400">AI ƒëang ƒë·ªëi chi·∫øu v·ªõi 50+ ti√™u ch√≠ b·ªánh vi·ªán...</p>
                    </div>
                    
                    <!-- Result Content -->
                    <div id="career-advice-result" class="p-6 md:p-8 space-y-6"></div>
                </div>

                <div class="mt-8 flex justify-end">
                    <button id="next-btn" onclick="nextStep(3)" class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-xl shadow-md hover:bg-blue-700 transition duration-200 flex items-center hidden">
                        B∆∞·ªõc ti·∫øp theo: T·ªëi ∆∞u CV <i data-lucide="chevron-right" class="w-5 h-5 ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: T·ªëi ∆∞u h√≥a CV & Tham kh·∫£o -->
            <div id="step-3" class="step-page">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 mr-4">
                        <span class="font-bold text-lg">3</span>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800">C√¥ng C·ª• T·ªëi ∆Øu H√≥a S·ª± Nghi·ªáp</h2>
                </div>

                <!-- Tab Buttons Step 3 -->
                <div class="flex space-x-2 mb-6 overflow-x-auto pb-2 no-scrollbar">
                    <button class="tab-button tab-button-step4 active whitespace-nowrap" onclick="showTabStep4('cv-review', this)">
                        <i data-lucide="scan-face" class="w-4 h-4 mr-2"></i> Soi L·ªói & S·ª≠a CV
                    </button>
                    <button class="tab-button tab-button-step4 whitespace-nowrap" onclick="showTabStep4('cv-templates', this)">
                        <i data-lucide="file-check-2" class="w-4 h-4 mr-2"></i> Vi·∫øt CV M·∫´u
                    </button>
                    <button class="tab-button tab-button-step4 whitespace-nowrap" onclick="showTabStep4('qna-reference', this)">
                        <i data-lucide="message-circle-question" class="w-4 h-4 mr-2"></i> Ph·ªèng v·∫•n Q&A
                    </button>
                </div>

                <!-- Content 1: Soi L·ªói CV -->
                <div id="cv-review" class="tab-content-step4 active">
                    <div class="bg-orange-50 border border-orange-100 rounded-2xl p-6 mb-6">
                        <h3 class="text-lg font-bold text-orange-800 mb-2 flex items-center">
                            <i data-lucide="microscope" class="w-5 h-5 mr-2"></i> Ch·∫©n ƒëo√°n H·ªì s∆°
                        </h3>
                        <p class="text-sm text-orange-700 mb-4">AI s·∫Ω ƒë√≥ng vai Nh√† tuy·ªÉn d·ª•ng kh√≥ t√≠nh ƒë·ªÉ t√¨m ra ƒëi·ªÉm y·∫øu trong h·ªì s∆° c·ªßa b·∫°n.</p>
                        <button onclick="analyzeCvGaps()" class="px-5 py-2 bg-white border border-orange-200 text-orange-700 font-semibold rounded-lg hover:bg-orange-100 transition shadow-sm flex items-center">
                            <i data-lucide="scan-search" class="w-4 h-4 mr-2"></i> Qu√©t L·ªói Ngay
                        </button>
                    </div>
                    <div id="cv-gaps-result" class="fade-in hidden"></div>
                </div>

                <!-- Content 2: Vi·∫øt CV M·∫´u -->
                <div id="cv-templates" class="tab-content-step4">
                    <div class="bg-blue-50 border border-blue-100 rounded-2xl p-6 mb-6">
                         <h3 class="text-lg font-bold text-blue-800 mb-2 flex items-center">
                            <i data-lucide="pen-tool" class="w-5 h-5 mr-2"></i> AI Resume Writer
                        </h3>
                        <p class="text-sm text-blue-700 mb-4">T·ª± ƒë·ªông vi·∫øt l·∫°i CV c·ªßa b·∫°n theo chu·∫©n ATS, ng√¥n ng·ªØ chuy√™n ng√†nh y t·∫ø, t·∫≠p trung v√†o th√†nh t·ª±u.</p>
                        <button onclick="generateOptimizedCV()" class="px-5 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition shadow-md flex items-center">
                            <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i> Vi·∫øt CV M·ªõi
                        </button>
                    </div>
                    <div id="optimized-cv-result" class="fade-in hidden"></div>
                </div>

                <!-- Content 3: Q&A -->
                <div id="qna-reference" class="tab-content-step4">
                     <div class="bg-emerald-50 border border-emerald-100 rounded-2xl p-6 mb-6">
                        <h3 class="text-lg font-bold text-emerald-800 mb-2 flex items-center">
                            <i data-lucide="users-2" class="w-5 h-5 mr-2"></i> M√¥ ph·ªèng Ph·ªèng v·∫•n
                        </h3>
                        <p class="text-sm text-emerald-700 mb-4">T·∫°o b·ªô c√¢u h·ªèi ph·ªèng v·∫•n s√°t th·ª±c t·∫ø nh·∫•t cho v·ªã tr√≠ <strong id="qna-job-title">...</strong></p>
                        <button onclick="generateQnAReference()" class="px-5 py-2 bg-emerald-600 text-white font-semibold rounded-lg hover:bg-emerald-700 transition shadow-md flex items-center">
                            <i data-lucide="play-circle" class="w-4 h-4 mr-2"></i> T·∫°o C√¢u h·ªèi & G·ª£i √Ω
                        </button>
                    </div>
                    <div id="qna-reference-result" class="space-y-4 fade-in hidden"></div>
                </div>

                <button onclick="finishApp()" class="mt-10 w-full py-4 border-2 border-slate-200 text-slate-600 font-bold rounded-xl hover:bg-slate-50 transition flex items-center justify-center">
                    <i data-lucide="check-circle-2" class="w-5 h-5 mr-2"></i> K·∫øt th√∫c phi√™n t∆∞ v·∫•n
                </button>
            </div>
            <div class="footer">&copy - HuongNghiepDieuDuong</div>
        </main>
    </div>

    <!-- Loading Spinner (Global) -->
    <div id="loading-spinner" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-white p-8 rounded-2xl shadow-2xl flex flex-col items-center animate-bounce-small">
            <i data-lucide="activity" class="w-12 h-12 text-emerald-500 animate-pulse mb-4"></i>
            <span class="text-slate-700 font-semibold text-lg">AI ƒëang x·ª≠ l√Ω d·ªØ li·ªáu...</span>
            <span class="text-slate-500 text-sm mt-2">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</span>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // ==========================================
        // C·∫§U H√åNH API KEY (QUAN TR·ªåNG NH·∫§T CHO GITHUB PAGES)
        // ==========================================
        //
        // H∆Ø·ªöNG D·∫™N:
        // 1. ƒê·ªÉ ch·∫°y file n√†y tr√™n GitHub Pages m√† KH√îNG c·∫ßn nh·∫≠p Key m·ªói l·∫ßn:
        //    H√£y D√ÅN API Key c·ªßa b·∫°n v√†o gi·ªØa hai d·∫•u ngo·∫∑c k√©p ·ªü d√≤ng d∆∞·ªõi ƒë√¢y.
        //    V√≠ d·ª•: const userHardcodedKey = "AIzaSyD...key_cua_ban";
        // 2. N·∫øu ƒë·ªÉ tr·ªëng (""), h·ªá th·ªëng s·∫Ω h·ªèi ng∆∞·ªùi d√πng nh·∫≠p Key. Key n√†y s·∫Ω ƒë∆∞·ª£c l∆∞u
        //    trong tr√¨nh duy·ªát (LocalStorage) cho c√°c l·∫ßn truy c·∫≠p sau.
        
        const userHardcodedKey = "AIzaSyC9inP5GExlMQUVXJ6dFKXUPqL_PATE0tw"; 

        // ==========================================
        
        const systemProvidedKey = ""; // System injected (usually empty in local/static hosting)
        let currentStep = 1;
        const totalSteps = 3;
        let collectedData = {};

        // DOM Cache
        const els = {
            progressBar: document.getElementById('progress-bar'),
            stepName: document.getElementById('step-name'),
            stepCounter: document.getElementById('step-counter'),
            loadingSpinner: document.getElementById('loading-spinner'),
            summarySelect: document.getElementById('summary-select'),
            summaryInput: document.getElementById('summary-input'),
            summaryPlaceholder: document.getElementById('summary-placeholder'),
            salaryPreset: document.getElementById('salary-preset'),
            salaryCustom: document.getElementById('salary-custom-input'),
            certOtherInput: document.getElementById('cert-other-input'),
            careerPathSelect: document.getElementById('career-path-select')
        };

        const stepNames = [
            "Kh·ªüi t·∫°o h·ªì s∆° chuy√™n m√¥n", "Ph√¢n t√≠ch & ƒê·ªãnh h∆∞·ªõng", "C√¥ng c·ª• ph√°t tri·ªÉn s·ª± nghi·ªáp"
        ];

        // --- UI Interactions ---
        
        // Handle Salary Input Toggle
        els.salaryPreset.addEventListener('change', function() {
            if (this.value === 'other') {
                els.salaryCustom.classList.remove('hidden');
                els.salaryCustom.value = '';
                els.salaryCustom.focus();
            } else {
                els.salaryCustom.classList.add('hidden');
                els.salaryCustom.value = this.value;
            }
        });

        // Handle Summary Logic
        window.toggleCustomSummary = () => {
            const val = els.summarySelect.value;
            let text = "";
            
            if (val === 'custom') {
                els.summaryInput.classList.remove('hidden');
                els.summaryPlaceholder.classList.add('hidden');
                els.summaryInput.focus();
            } else {
                els.summaryInput.classList.add('hidden');
                els.summaryPlaceholder.classList.remove('hidden');
                
                // Pre-defined texts
                if(val === 'dynamic') text = "T√¥i l√† ƒêi·ªÅu d∆∞·ª°ng vi√™n NƒÉng ƒë·ªông, m·∫°nh v·ªÅ giao ti·∫øp v√† l√†m vi·ªác nh√≥m. Th√≠ch c√°c ho·∫°t ƒë·ªông c·ªông ƒë·ªìng.";
                if(val === 'cautious') text = "T√¥i l√† ng∆∞·ªùi C·∫©n tr·ªçng, t·ªâ m·ªâ, tu√¢n th·ªß quy tr√¨nh nghi√™m ng·∫∑t. Ph√π h·ª£p m√¥i tr∆∞·ªùng ICU/Ph√≤ng m·ªï.";
                if(val === 'stable') text = "T√¥i l√† ng∆∞·ªùi ·ªîn ƒë·ªãnh, ki√™n nh·∫´n, th√≠ch s·ª± g·∫Øn b√≥ l√¢u d√†i v√† chƒÉm s√≥c b·ªánh nh√¢n t·∫≠n t√¨nh.";
                
                els.summaryPlaceholder.textContent = `"${text}"`;
                els.summaryInput.value = text;
            }
        };

        // Tab Switching Logic
        window.showTab = (tabId, btn) => {
            // Reset logic for Step 1 tabs
            document.querySelectorAll('#step-1 .tab-button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            document.querySelectorAll('#step-1 .tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            // Clear data on switch to avoid confusion
            if(tabId === 'manual-input') document.getElementById('cv-content-input').value = '';
        };

        window.showTabStep4 = (tabId, btn) => {
            document.querySelectorAll('#step-3 .tab-button-step4').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            document.querySelectorAll('#step-3 .tab-content-step4').forEach(c => {
                c.classList.remove('active');
                c.style.display = 'none'; // Force hide
            });
            
            const target = document.getElementById(tabId);
            target.style.display = 'block';
            setTimeout(() => target.classList.add('active'), 10); // Small delay for animation

            // Update Job Title for Q&A Tab
            if (tabId === 'qna-reference') {
                document.getElementById('qna-job-title').textContent = collectedData.careerPath || "...";
            }
        };

        // --- Core Logic & API ---

        window.resetApiKey = () => {
            if(confirm("B·∫°n c√≥ mu·ªën x√≥a API Key ƒëang l∆∞u trong tr√¨nh duy·ªát ƒë·ªÉ nh·∫≠p Key m·ªõi kh√¥ng?")) {
                localStorage.removeItem('gemini_api_key');
                alert("ƒê√£ x√≥a Key. L·∫ßn ch·∫°y ti·∫øp theo h·ªá th·ªëng s·∫Ω y√™u c·∫ßu b·∫°n nh·∫≠p Key m·ªõi.");
                location.reload(); // Reload to apply changes
            }
        };

        function updateStepUI(step) {
            document.querySelectorAll('.step-page').forEach(el => el.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');

            const progress = (step / totalSteps) * 100;
            els.progressBar.style.width = `${progress}%`;
            els.stepName.textContent = stepNames[step - 1];
            els.stepCounter.textContent = `${step} / ${totalSteps}`;

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.nextStep = (s) => {
            currentStep = s;
            updateStepUI(currentStep);
        };

        window.finishApp = () => {
            alert("Phi√™n t∆∞ v·∫•n k·∫øt th√∫c. Ch√∫c b·∫°n th√†nh c√¥ng tr√™n con ƒë∆∞·ªùng s·ª± nghi·ªáp!");
        };

        // Data Collection
        window.collectManualData = () => {
            const hardSkills = Array.from(document.querySelectorAll('input[name="hard-skill"]:checked')).map(c => c.value);
            if (document.getElementById('hard-skill-custom').value.trim()) {
                hardSkills.push(document.getElementById('hard-skill-custom').value.trim());
            }

            const softSkills = Array.from(document.querySelectorAll('input[name="soft-skill"]:checked')).map(c => c.value);
            if (document.getElementById('soft-skill-custom').value.trim()) {
                softSkills.push(document.getElementById('soft-skill-custom').value.trim());
            }

            const certs = Array.from(document.querySelectorAll('input[name="certificate"]:checked')).map(c => c.value);
            if(els.certOtherInput.value) certs.push(els.certOtherInput.value);

            return {
                name: document.getElementById('name-input').value,
                age: document.getElementById('age-input').value,
                gender: document.getElementById('gender-input').value,
                degree: document.getElementById('degree-input').value,
                experience: document.getElementById('experience-input').value,
                summary: els.summaryInput.value,
                salary: els.salaryCustom.value || els.salaryPreset.value,
                environment: document.getElementById('environment-input').value,
                hardSkills: hardSkills.join(', '),
                softSkills: softSkills.join(', '),
                certificates: certs.join(', ')
            };
        };

        window.submitPersonalData = async () => {
            const careerPath = els.careerPathSelect.value;
            if(!careerPath) return alert("Vui l√≤ng ch·ªçn Chuy√™n Ng√†nh M·ª•c ti√™u!");
            
            const activeTab = document.querySelector('#step-1 .tab-content.active').id;
            
            if(activeTab === 'cv-input-area') {
                const cvText = document.getElementById('cv-content-input').value;
                if(!cvText.trim()) return alert("Vui l√≤ng d√°n n·ªôi dung CV!");
                collectedData = { source: 'CV', careerPath, cvContent: cvText };
            } else {
                const manualData = collectManualData();
                if(!manualData.name) return alert("Vui l√≤ng nh·∫≠p t√™n!");
                collectedData = { source: 'Manual', careerPath, ...manualData };
            }

            nextStep(2);
            await generateCareerAdvice();
        };

        // API Helper
        async function getValidApiKey() {
            // 1. Check Hardcoded Key first (User added - Best for static hosting like GitHub Pages)
            if (userHardcodedKey && userHardcodedKey.trim() !== "") {
                return userHardcodedKey.trim();
            }

            // 2. Check System Key (Environment injected - Relevant for Canvas, ignored on GitHub Pages)
            if (systemProvidedKey && systemProvidedKey.trim() !== "") {
                return systemProvidedKey.trim();
            }

            // 3. Check LocalStorage (Saved from previous run)
            const localKey = localStorage.getItem('gemini_api_key');
            if (localKey && localKey.trim() !== "") {
                return localKey.trim();
            }

            // 4. If all else fails, prompt user
            const input = prompt("·ª®ng d·ª•ng c·∫ßn Google Gemini API Key ƒë·ªÉ ho·∫°t ƒë·ªông.\n\nNh·∫≠p Key c·ªßa b·∫°n v√†o ƒë√¢y (Key s·∫Ω ƒë∆∞·ª£c l∆∞u v√†o tr√¨nh duy·ªát cho l·∫ßn sau):\n(L·∫•y key mi·ªÖn ph√≠ t·∫°i: aistudio.google.com)");
            
            if (input && input.trim() !== "") {
                const key = input.trim();
                localStorage.setItem('gemini_api_key', key); // SAVE TO LOCAL STORAGE
                return key;
            }

            return null;
        }

        async function callGeminiAPI(sysPrompt, userPrompt) {
            const finalKey = await getValidApiKey();
            
            if (!finalKey) {
                alert("B·∫°n c·∫ßn cung c·∫•p API Key ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng ph√¢n t√≠ch AI.");
                els.loadingSpinner.classList.add('hidden');
                // Go back to step 1 if failed
                nextStep(1); 
                return null;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${finalKey}`;

            els.loadingSpinner.classList.remove('hidden');
            try {
                // Implementing a simple retry mechanism with exponential backoff for robustness
                const maxRetries = 3;
                let lastResult = null;
                for (let i = 0; i < maxRetries; i++) {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userPrompt }] }],
                            generationConfig: { temperature: 0.7 },
                            systemInstruction: { parts: [{ text: sysPrompt }] }
                        })
                    });
                    
                    const data = await response.json();

                    if (!data.error) {
                        lastResult = data;
                        break; // Success
                    }

                    // Handle specific errors like API Key invalidation
                    if (data.error.code === 400 || data.error.message.includes('API key')) {
                        console.error("API Key Invalid/Expired:", data.error.message);
                        alert(`API Key kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n!\n\nH·ªá th·ªëng s·∫Ω x√≥a Key c≈©. Vui l√≤ng th·ª≠ l·∫°i v·ªõi Key m·ªõi.`);
                        localStorage.removeItem('gemini_api_key');
                        els.loadingSpinner.classList.add('hidden');
                        return null; // Stop immediately
                    }

                    // For other temporary errors (e.g., rate limits), wait and retry
                    if (i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw new Error(`Failed after ${maxRetries} retries: ${data.error.message || 'Unknown error'}`);
                    }
                }
                
                els.loadingSpinner.classList.add('hidden');
                return lastResult.candidates?.[0]?.content?.parts?.[0]?.text || null;

            } catch (e) {
                els.loadingSpinner.classList.add('hidden');
                alert("L·ªói k·∫øt n·ªëi m·∫°ng ho·∫∑c API: " + e.message);
                return null;
            }
        }

        // --- AI Features with Optimized HTML Output ---

        // 1. Career Advice (Step 2)
        window.generateCareerAdvice = async () => {
            const container = document.getElementById('career-advice-result');
            const loader = document.getElementById('analysis-loading');
            const nextBtn = document.getElementById('next-btn');
            
            container.innerHTML = '';
            loader.classList.remove('hidden');
            nextBtn.classList.add('hidden');

            const dataStr = JSON.stringify(collectedData);
            const systemPrompt = `B·∫°n l√† Gi√°m ƒë·ªëc ƒêi·ªÅu d∆∞·ª°ng (Chief Nursing Officer) v·ªõi 20 nƒÉm kinh nghi·ªám.
            Nhi·ªám v·ª•: Ph√¢n t√≠ch h·ªì s∆° ·ª©ng vi√™n v√† ƒë∆∞a ra l·ªùi khuy√™n chi·∫øn l∆∞·ª£c.
            
            QUAN TR·ªåNG: Tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m√£ HTML (kh√¥ng c·∫ßn th·∫ª <html>, <body>). S·ª≠ d·ª•ng Tailwind CSS cho giao di·ªán ƒë·∫πp.
            
            C·∫•u tr√∫c HTML mong mu·ªën:
            <div class="space-y-6">
                <!-- ƒêi·ªÉm s·ªë ph√π h·ª£p -->
                <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 flex items-center justify-between">
                    <div>
                        <h3 class="text-xl font-bold text-indigo-900">M·ª©c ƒë·ªô ph√π h·ª£p: [ƒêi·ªÉm]/10</h3>
                        <p class="text-indigo-700 text-sm">[Nh·∫≠n x√©t ng·∫Øn 1 c√¢u]</p>
                    </div>
                    <div class="text-4xl">üéØ</div>
                </div>

                <!-- Ph√¢n t√≠ch chi ti·∫øt (Grid 2 c·ªôt) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-emerald-50 p-5 rounded-xl border border-emerald-100">
                        <h4 class="font-bold text-emerald-800 mb-3 flex items-center">‚úÖ ƒêi·ªÉm m·∫°nh</h4>
                        <ul class="space-y-2 text-sm text-emerald-900">
                            <li>[ƒêi·ªÉm m·∫°nh 1]</li>
                            <li>[ƒêi·ªÉm m·∫°nh 2]</li>
                        </ul>
                    </div>
                    <div class="bg-orange-50 p-5 rounded-xl border border-orange-100">
                        <h4 class="font-bold text-orange-800 mb-3 flex items-center">‚ö†Ô∏è C·∫ßn c·∫£i thi·ªán</h4>
                        <ul class="space-y-2 text-sm text-orange-900">
                            <li>[ƒêi·ªÉm y·∫øu 1]</li>
                            <li>[ƒêi·ªÉm y·∫øu 2]</li>
                        </ul>
                    </div>
                </div>

                <!-- L·ªô tr√¨nh (Timeline) -->
                <div class="bg-white border border-slate-200 p-6 rounded-xl shadow-sm">
                    <h4 class="font-bold text-slate-800 mb-4 text-lg">üìç L·ªô tr√¨nh ph√°t tri·ªÉn 3 nƒÉm t·ªõi</h4>
                    <div class="space-y-4 border-l-2 border-blue-200 pl-4">
                        <div class="relative">
                            <div class="absolute -left-[21px] top-1 w-3 h-3 bg-blue-500 rounded-full"></div>
                            <h5 class="font-bold text-slate-700">Ng·∫Øn h·∫°n (0-1 nƒÉm)</h5>
                            <p class="text-sm text-slate-600">[H√†nh ƒë·ªông c·ª• th·ªÉ: H·ªçc ch·ª©ng ch·ªâ g√¨? L√†m ·ªü ƒë√¢u?]</p>
                        </div>
                         <div class="relative">
                            <div class="absolute -left-[21px] top-1 w-3 h-3 bg-blue-300 rounded-full"></div>
                            <h5 class="font-bold text-slate-700">Trung h·∫°n (1-3 nƒÉm)</h5>
                            <p class="text-sm text-slate-600">[M·ª•c ti√™u thƒÉng ti·∫øn]</p>
                        </div>
                    </div>
                </div>
            </div>`;

            const result = await callGeminiAPI(systemPrompt, `Ph√¢n t√≠ch d·ªØ li·ªáu sau cho v·ªã tr√≠ ${collectedData.careerPath}: ${dataStr}`);
            
            loader.classList.add('hidden');
            if(result) {
                // Clean markdown tags if any
                const cleanHtml = result.replace(/```html/g, '').replace(/```/g, '');
                container.innerHTML = cleanHtml;
                nextBtn.classList.remove('hidden');
            } else {
                container.innerHTML = `<div class="text-center p-6 bg-red-50 text-red-600 rounded-lg border border-red-200">
                    <p class="font-bold">L·ªói ph√¢n t√≠ch ho·∫∑c thi·∫øu d·ªØ li·ªáu.</p>
                    <p class="text-sm mt-2">Vui l√≤ng ki·ªÉm tra l·∫°i k·∫øt n·ªëi m·∫°ng ho·∫∑c API Key.</p>
                </div>`;
            }
        };

        // 2. CV Gaps Analysis (Step 3 - Tab 1)
        window.analyzeCvGaps = async () => {
            const container = document.getElementById('cv-gaps-result');
            container.classList.remove('hidden');
            container.innerHTML = '<div class="animate-pulse p-4 bg-slate-100 rounded text-center text-slate-500">ƒêang soi l·ªói h·ªì s∆°...</div>';

            const systemPrompt = `B·∫°n l√† Nh√† tuy·ªÉn d·ª•ng Y t·∫ø kh√≥ t√≠nh. H√£y t√¨m ra c√°c l·ªó h·ªïng trong h·ªì s∆° ·ª©ng vi√™n.
            Tr·∫£ v·ªÅ HTML s·ª≠ d·ª•ng Tailwind CSS.
            
            Format:
            <div class="space-y-4">
                <div class="flex items-start p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg">
                    <div class="flex-1">
                        <h4 class="font-bold text-red-800">1. [T√™n L·ªó H·ªïng]</h4>
                        <p class="text-sm text-red-700 mt-1">[Gi·∫£i th√≠ch t·∫°i sao ƒë√¢y l√† v·∫•n ƒë·ªÅ]</p>
                        <p class="text-xs font-semibold text-red-600 mt-2">üí° Kh·∫Øc ph·ª•c: [L·ªùi khuy√™n ng·∫Øn]</p>
                    </div>
                </div>
                <!-- L·∫∑p l·∫°i cho 2-3 l·ªó h·ªïng -->
            </div>`;

            const result = await callGeminiAPI(systemPrompt, `T√¨m l·ªó h·ªïng cho v·ªã tr√≠ ${collectedData.careerPath}. D·ªØ li·ªáu: ${JSON.stringify(collectedData)}`);
            if (result) {
                container.innerHTML = result.replace(/```html/g, '').replace(/```/g, '');
            } else {
                container.innerHTML = '<p class="text-red-500">Kh√¥ng th·ªÉ ph√¢n t√≠ch. Vui l√≤ng th·ª≠ l·∫°i.</p>';
            }
        };

        // 3. Generate Optimized CV (Step 3 - Tab 2)
        window.generateOptimizedCV = async () => {
            const container = document.getElementById('optimized-cv-result');
            container.classList.remove('hidden');
            container.innerHTML = '<div class="animate-pulse p-4 bg-slate-100 rounded text-center text-slate-500">ƒêang vi·∫øt l·∫°i CV chuy√™n nghi·ªáp...</div>';

            const systemPrompt = `B·∫°n l√† Chuy√™n gia CV Y t·∫ø. H√£y vi·∫øt l·∫°i n·ªôi dung CV c·ªßa ·ª©ng vi√™n cho v·ªã tr√≠ ${collectedData.careerPath}.
            T·∫≠p trung v√†o: T·ª´ kh√≥a chuy√™n ng√†nh (ATS), ƒê·ªãnh l∆∞·ª£ng th√†nh t√≠ch (s·ªë li·ªáu), S·ª≠ d·ª•ng ƒë·ªông t·ª´ m·∫°nh.
            
            Format HTML (class 'cv-paper'):
            <div class="cv-paper">
                <h2 class="text-2xl font-bold uppercase border-b-2 border-black pb-2 mb-4 text-center">[T√™n ·ª®ng Vi√™n]</h2>
                <div class="mb-4">
                    <h3 class="font-bold uppercase text-sm border-b mb-2">M·ª•c ti√™u ngh·ªÅ nghi·ªáp</h3>
                    <p class="text-sm text-justify">[ƒêo·∫°n vƒÉn ng·∫Øn g·ªçn, s·∫Øc b√©n]</p>
                </div>
                <div class="mb-4">
                    <h3 class="font-bold uppercase text-sm border-b mb-2">Kinh nghi·ªám l√†m vi·ªác</h3>
                    <!-- Li·ªát k√™ 2-3 ƒë·∫ßu vi·ªác quan tr·ªçng nh·∫•t ƒë∆∞·ª£c vi·∫øt l·∫°i -->
                    <ul class="list-disc ml-5 text-sm space-y-1">
                        <li>[ƒê·ªông t·ª´ m·∫°nh] + [Nhi·ªám v·ª•] + [K·∫øt qu·∫£/S·ªë li·ªáu]</li>
                    </ul>
                </div>
                <div class="mb-4">
                    <h3 class="font-bold uppercase text-sm border-b mb-2">K·ªπ nƒÉng n·ªïi b·∫≠t</h3>
                    <p class="text-sm">[Li·ªát k√™ c√°c k·ªπ nƒÉng Hard/Soft skills quan tr·ªçng nh·∫•t cho v·ªã tr√≠ n√†y]</p>
                </div>
            </div>`;

            const result = await callGeminiAPI(systemPrompt, `Vi·∫øt CV cho h·ªì s∆°: ${JSON.stringify(collectedData)}`);
            if (result) {
                container.innerHTML = result.replace(/```html/g, '').replace(/```/g, '');
            } else {
                container.innerHTML = '<p class="text-red-500">Kh√¥ng th·ªÉ t·∫°o CV. Vui l√≤ng th·ª≠ l·∫°i.</p>';
            }
        };

        // 4. Generate Q&A Reference (Step 3 - Tab 3)
        window.generateQnAReference = async () => {
            const container = document.getElementById('qna-reference-result');
            container.classList.remove('hidden');
            container.innerHTML = '<div class="animate-pulse p-4 bg-slate-100 rounded text-center text-slate-500">ƒêang t·ªïng h·ª£p b·ªô c√¢u h·ªèi ph·ªèng v·∫•n...</div>';

            const systemPrompt = `B·∫°n l√† Tr∆∞·ªüng khoa ƒëang ph·ªèng v·∫•n tuy·ªÉn d·ª•ng v·ªã tr√≠ ${collectedData.careerPath}.
            H√£y ƒë∆∞a ra 3 c√¢u h·ªèi ph·ªèng v·∫•n h√≥c b√∫a nh·∫•t v√† g·ª£i √Ω tr·∫£ l·ªùi th√¥ng minh.
            
            Format HTML:
            <div class="space-y-4">
                <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                    <p class="font-bold text-slate-800 text-lg mb-2">‚ùì C√¢u h·ªèi 1: [N·ªôi dung c√¢u h·ªèi]</p>
                    <div class="bg-emerald-50 p-3 rounded text-sm text-emerald-800">
                        <strong>üí° G·ª£i √Ω tr·∫£ l·ªùi:</strong> [H∆∞·ªõng d·∫´n tr·∫£ l·ªùi theo m√¥ h√¨nh STAR ho·∫∑c t·∫≠p trung v√†o an to√†n ng∆∞·ªùi b·ªánh]
                    </div>
                </div>
                <!-- L·∫∑p l·∫°i 3 c√¢u -->
            </div>`;

            const result = await callGeminiAPI(systemPrompt, `T·∫°o c√¢u h·ªèi ph·ªèng v·∫•n cho h·ªì s∆°: ${JSON.stringify(collectedData)}`);
            if (result) {
                container.innerHTML = result.replace(/```html/g, '').replace(/```/g, '');
            } else {
                container.innerHTML = '<p class="text-red-500">Kh√¥ng th·ªÉ t·∫°o c√¢u h·ªèi. Vui l√≤ng th·ª≠ l·∫°i.</p>';
            }
        };

        // Initialize Lucide Icons
        lucide.createIcons();
    </script>
    
</body>
</html>